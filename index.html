<!-- 
	To-do:
		Add comments throughout code
		Add API to get current project's RACs automatically
		Add CPID input and call an API to get user's RACs
		Make pretty
		Add ads
		...
		Profit?
-->

<!DOCTYPE html>
<html>
	<head>
		<title>Katiee's GRC Magnitude/Earnings Calculator</title>
		<style type="text/css">
			.hidden {
				display:none;
			}
			* {
				font-family: Verdana, Arial, sans-serif;
			} 
		</style>
		
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>

		<noscript><b>Sorry, your browser does not support JavaScript or you have it disabled, please enable it or upgrade your browser!</b></noscript>

		<script type="text/javascript">
		window.onload=function(){
			document.getElementById("divMain").style.display = "block";
			var last_selected_item = "";
			var selected_item;
			var projectsOutput = [];
			var whitelistNum = 36;
			var nnMultiplier = 115000;
			
			// Load arrays with API data
			var projects = ['Asteroids@home','ATLAS@Home','Bitcoin Utopia','BURP','CAS@home','Citizen Science Grid','climateprediction.net','Collatz Conjecture','Cosmology@Home','DENIS@Home','Distributed Data Mining','Einstein@Home','Enigma@Home','Find@Home','GPUGRID','Leiden Classical','LHC@home','malariacontrol.net','MilkyWay@home','MindModeling@Home','Moo! Wrapper','NFS@Home','NumberFields@home','POEM@HOME','PrimeGrid','Rosetta@home','SAT@home','SETI@home','SZTAKI Desktop Grid','theSkyNet POGS','Universe@Home','vLHCathome','World Community Grid','WUProp@Home','YAFU','yoyo@home'];
			var projects_RACs = [888000,11333.33,653655410,11000,8760,111333.33,25000,17827090,60333.33,562000,41166.67,1725714.29,202000,94000,7751428.57,26333.33,24833.33,108666.67,1820000,49166.67,2440000,114666.67,208666.67,7418571.43,5577142.86,207333.33,114000,674000,15833.33,160000,235333.33,15333.33,384666.67,11333.33,108666.67,101333.33];
			
			// Create the main body (Load whitelisted projects and RACs from API)
			// 	For now just loop through the project array
			var htmlSelect = '<select id="choice"><option>-PROJECTS-</option>'
			var htmlDivs = "";
			var i = 0;
			for (; projects[i];) {
				htmlSelect += '<option value="' + projects[i] + '">' + projects[i] + '</option>';
				htmlDivs += '<div id="' + projects[i] + 'div" style="display:none">';
				htmlDivs += projects[i] + ' RAC: <input type="text" id="' + projects[i] + '_userRAC"/><br>';
				htmlDivs += projects[i] + ' Team Total RAC: <input type="text" id="' + projects[i] + '_teamRAC"/>';
				htmlDivs += '<div id="' + projects[i] + 'output"></div></div>';
				i++;
			}
			
			document.getElementById('dropdown').innerHTML += htmlSelect + '</select>';
			document.getElementById('calc').innerHTML += htmlDivs;
			// End
			
			// Load up the text fields with project RACs
			var i = 0;
			for (; projects[i];) {
				document.getElementById(projects[i] + '_teamRAC').value = projects_RACs[i];
				i++;
			}
			// End

			$('#calc').keyup(function (e) {
				var userRAC = document.getElementById(selected_item + '_userRAC').value;
				var teamRAC = document.getElementById(selected_item + '_teamRAC').value;
				var userMag = (((parseFloat(userRAC) / (parseFloat(teamRAC) + 0.01)) / (parseFloat(whitelistNum) + 0.01)) * parseFloat(nnMultiplier)).toFixed(2);
				document.getElementById(selected_item + 'output').innerHTML = '<br><b>' + selected_item + ' Magnitude:</b> ' + userMag;

				var index = projectsOutput.indexOf(selected_item);
				if (index == -1) {
					projectsOutput.push(selected_item, userMag);
				} else {
					projectsOutput[index + 1] = userMag;
				}
				
				document.getElementById('magLabel').innerHTML = '<b>All Magnitudes:</b>';

				var output = '';
				var total_mag = 0;
				var i = 0;
				while (projectsOutput.length > i) {
					output += projectsOutput[i] + ' = ' + projectsOutput[i + 1] + '<br>';
					total_mag += parseFloat(projectsOutput[i + 1]);
					i = i + 2;
				}

				output = output + '<br><br><b>Total Mag:</b> ' + total_mag.toFixed(2); // I have no idea why we need to round here..
				
				var grc = '<br><b>Daily Earnings:</b> ' + (total_mag.toFixed(2) * 0.35).toFixed(8) + ' GRC';

				document.getElementById('projectOutput').innerHTML = output + grc;
			});

			$('#choice').change(function () {
				selected_item = $(this).val();

				var i = 0;
				for (; projects[i];) {
					if (selected_item == projects[i]) {
						document.getElementById(projects[i] + 'div').style.display = 'block';
					} else if (last_selected_item == projects[i]) {
						document.getElementById(last_selected_item + 'div').style.display = 'none';
					}
					i++;
				}

				last_selected_item = selected_item;
			});
		};
		</script>
	</head>
    <body>
		<div id="divMain" style="display: none">
			<h1> Katiee's GRC Magnitude/Earnings Calculator </h1> 
			<font size="2"><i>* Data last updated: November 01, 2015</i></font>
			<br>
			<br>
			Current number of white-listed projects: 36
			<br>
			Neural Network Multiplier: 115000
			<br>
			<br>
			<div id="dropdown"></div>
			<div id="calc"></div>
			<br>
			<br> 
			<div id='magLabel'></div> 
			<div id='projectOutput'></div>
			<div id='totalOutput'></div>
		</div>
    </body>
</html>
